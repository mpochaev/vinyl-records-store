<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8"><title>История заказов (Админ)</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<th:block th:replace="~{fragments/nav :: navBar}"></th:block>
<h2>История заказов</h2>
<table>
    <thead>
    <tr>
        <th>Альбом</th><th>Исполнитель</th><th>Сумма</th><th>ID покупателя</th><th>Статус</th><th>Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="order : ${orders}">
        <td th:text="${order.vinyl.title}">Альбом</td>
        <td th:text="${order.vinyl.artist}">Исполнитель</td>
        <td th:text="${#numbers.formatDecimal(order.totalPrice, 2, 2)}">0.00</td>
        <td th:text="${order.user.id}">0</td>
        <td>
          <span th:if="${order.status == T(com.vinylrecordsstore.enums.OrderStatus).PURCHASED}">
            <span style="color:green;">&#10004;</span>
          </span>
            <span th:if="${order.status == T(com.vinylrecordsstore.enums.OrderStatus).CANCELLED}">
            <span style="color:red;">&#10008;</span>
          </span>
            <span th:if="${order.status == T(com.vinylrecordsstore.enums.OrderStatus).PLACED}">
            Оформлен
          </span>
        </td>
        <td>
            <!-- Отметить как оплаченное -->
            <form th:if="${order.status == T(com.vinylrecordsstore.enums.OrderStatus).PLACED}"
                  th:action="@{'/admin/orders/' + ${order.id} + '/mark'}"
                  method="post" style="display:inline;">

                <!-- CSRF -->
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />

                <!-- номер страницы, чтобы не сбивалась пагинация -->
                <input type="hidden" name="page" th:value="${currentPage}" />

                <button type="submit" title="Отметить как оплаченное">&#10004;</button>
            </form>

            <!-- Удалить заказ -->
            <form th:action="@{'/admin/orders/' + ${order.id}}"
                  method="post" style="display:inline;">

                <!-- CSRF -->
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />

                <!-- номер страницы -->
                <input type="hidden" name="page" th:value="${currentPage}" />

                <button type="submit">Удалить</button>
            </form>
        </td>
    </tr>
    <tr th:if="${#lists.isEmpty(orders)}"><td colspan="6">Нет оформленных заказов.</td></tr>
    </tbody>
</table>
<div>
    Страница <span th:text="${currentPage + 1}"></span> из <span th:text="${totalPages}"></span>.
    <span th:if="${currentPage > 0}">
      <a th:href="@{'/admin/orders?page=' + ${currentPage - 1}}">« Назад</a>
    </span>
    <span th:if="${currentPage + 1 < totalPages}">
      <a th:href="@{'/admin/orders?page=' + ${currentPage + 1}}">Вперед »</a>
    </span>
</div>
</body>
</html>